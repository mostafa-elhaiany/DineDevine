import{__awaiter,__generator}from"tslib";
/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */import{g as getScrollElement,c as scrollByPoint,f as findClosestIonContent}from"./index-4392efa5.js";import{a as addEventListener,b as removeEventListener,r as raf,c as componentOnReady}from"./helpers-3379ba19.js";import{a as KeyboardResize,K as Keyboard}from"./keyboard-b063f012.js";import{w as win}from"./index-7a14ecec.js";import"./index-595d62c9.js";import"./capacitor-b4979570.js";var cloneMap=new WeakMap;var relocateInput=function(n,r,e,t,i){if(t===void 0){t=0}if(i===void 0){i=false}if(cloneMap.has(n)===e){return}if(e){addClone(n,r,t,i)}else{removeClone(n,r)}};var isFocused=function(n){return n===n.getRootNode().activeElement};var addClone=function(n,r,e,t){if(t===void 0){t=false}var i=r.parentNode;var o=r.cloneNode(false);o.classList.add("cloned-input");o.tabIndex=-1;if(t){o.disabled=true}i.appendChild(o);cloneMap.set(n,o);var a=n.ownerDocument;var u=a.dir==="rtl"?9999:-9999;n.style.pointerEvents="none";r.style.transform="translate3d(".concat(u,"px,").concat(e,"px,0) scale(0)")};var removeClone=function(n,r){var e=cloneMap.get(n);if(e){cloneMap.delete(n);e.remove()}n.style.pointerEvents="";r.style.transform=""};var SCROLL_AMOUNT_PADDING=50;var enableHideCaretOnScroll=function(n,r,e){if(!e||!r){return function(){return}}var t=function(e){if(isFocused(r)){relocateInput(n,r,e)}};var i=function(){return relocateInput(n,r,false)};var o=function(){return t(true)};var a=function(){return t(false)};addEventListener(e,"ionScrollStart",o);addEventListener(e,"ionScrollEnd",a);r.addEventListener("blur",i);return function(){removeEventListener(e,"ionScrollStart",o);removeEventListener(e,"ionScrollEnd",a);r.removeEventListener("blur",i)}};var SKIP_SELECTOR="input, textarea, [no-blur], [contenteditable]";var enableInputBlurring=function(){var n=true;var r=false;var e=document;var t=function(){r=true};var i=function(){n=true};var o=function(t){if(r){r=false;return}var i=e.activeElement;if(!i){return}if(i.matches(SKIP_SELECTOR)){return}var o=t.target;if(o===i){return}if(o.matches(SKIP_SELECTOR)||o.closest(SKIP_SELECTOR)){return}n=false;setTimeout((function(){if(!n){i.blur()}}),50)};addEventListener(e,"ionScrollStart",t);e.addEventListener("focusin",i,true);e.addEventListener("touchend",o,false);return function(){removeEventListener(e,"ionScrollStart",t,true);e.removeEventListener("focusin",i,true);e.removeEventListener("touchend",o,false)}};var SCROLL_ASSIST_SPEED=.3;var getScrollData=function(n,r,e,t){var i;var o=(i=n.closest("ion-item,[ion-item]"))!==null&&i!==void 0?i:n;return calcScrollData(o.getBoundingClientRect(),r.getBoundingClientRect(),e,t)};var calcScrollData=function(n,r,e,t){var i=n.top;var o=n.bottom;var a=r.top;var u=Math.min(r.bottom,t-e);var c=a+15;var d=u-SCROLL_AMOUNT_PADDING;var l=d-o;var f=c-i;var s=Math.round(l<0?-l:f>0?-f:0);var v=Math.min(s,i-a);var S=Math.abs(v);var _=S/SCROLL_ASSIST_SPEED;var w=Math.min(400,Math.max(150,_));return{scrollAmount:v,scrollDuration:w,scrollPadding:e,inputSafeY:-(i-c)+4}};var PADDING_TIMER_KEY="$ionPaddingTimer";var setScrollPadding=function(n,r,e){var t=n[PADDING_TIMER_KEY];if(t){clearTimeout(t)}if(r>0){n.style.setProperty("--keyboard-offset","".concat(r,"px"))}else{n[PADDING_TIMER_KEY]=setTimeout((function(){n.style.setProperty("--keyboard-offset","0px");if(e){e()}}),120)}};var setClearScrollPaddingListener=function(n,r,e){var t=function(){if(r){setScrollPadding(r,0,e)}};n.addEventListener("focusout",t,{once:true})};var currentPadding=0;var SKIP_SCROLL_ASSIST="data-ionic-skip-scroll-assist";var enableScrollAssist=function(n,r,e,t,i,o,a,u){if(u===void 0){u=false}var c=o&&(a===undefined||a.mode===KeyboardResize.None);var d=false;var l=win!==undefined?win.innerHeight:0;var f=function(i){if(d===false){d=true;return}jsSetFocus(n,r,e,t,i.detail.keyboardHeight,c,u,l,false)};var s=function(){d=false;win===null||win===void 0?void 0:win.removeEventListener("ionKeyboardDidShow",f);n.removeEventListener("focusout",s,true)};var v=function(){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(o){if(r.hasAttribute(SKIP_SCROLL_ASSIST)){r.removeAttribute(SKIP_SCROLL_ASSIST);return[2]}jsSetFocus(n,r,e,t,i,c,u,l);win===null||win===void 0?void 0:win.addEventListener("ionKeyboardDidShow",f);n.addEventListener("focusout",s,true);return[2]}))}))};n.addEventListener("focusin",v,true);return function(){n.removeEventListener("focusin",v,true);win===null||win===void 0?void 0:win.removeEventListener("ionKeyboardDidShow",f);n.removeEventListener("focusout",s,true)}};var setManualFocus=function(n){if(document.activeElement===n){return}n.setAttribute(SKIP_SCROLL_ASSIST,"true");n.focus()};var jsSetFocus=function(n,r,e,t,i,o,a,u,c){if(a===void 0){a=false}if(u===void 0){u=0}if(c===void 0){c=true}return __awaiter(void 0,void 0,void 0,(function(){var d,l,f,s,v,S;return __generator(this,(function(_){switch(_.label){case 0:if(!e&&!t){return[2]}d=getScrollData(n,e||t,i,u);if(e&&Math.abs(d.scrollAmount)<4){setManualFocus(r);if(o&&e!==null){setScrollPadding(e,currentPadding);setClearScrollPaddingListener(r,e,(function(){return currentPadding=0}))}return[2]}relocateInput(n,r,true,d.inputSafeY,a);setManualFocus(r);raf((function(){return n.click()}));if(o&&e){currentPadding=d.scrollPadding;setScrollPadding(e,currentPadding)}if(!(typeof window!=="undefined"))return[3,3];f=function(){return __awaiter(void 0,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:if(l!==undefined){clearTimeout(l)}window.removeEventListener("ionKeyboardDidShow",s);window.removeEventListener("ionKeyboardDidShow",f);if(!e)return[3,2];return[4,scrollByPoint(e,0,d.scrollAmount,d.scrollDuration)];case 1:t.sent();t.label=2;case 2:relocateInput(n,r,false,d.inputSafeY);setManualFocus(r);if(o){setClearScrollPaddingListener(r,e,(function(){return currentPadding=0}))}return[2]}}))}))};s=function(){window.removeEventListener("ionKeyboardDidShow",s);window.addEventListener("ionKeyboardDidShow",f)};if(!e)return[3,2];return[4,getScrollElement(e)];case 1:v=_.sent();S=v.scrollHeight-v.clientHeight;if(c&&d.scrollAmount>S-v.scrollTop){if(r.type==="password"){d.scrollAmount+=SCROLL_AMOUNT_PADDING;window.addEventListener("ionKeyboardDidShow",s)}else{window.addEventListener("ionKeyboardDidShow",f)}l=setTimeout(f,1e3);return[2]}_.label=2;case 2:f();_.label=3;case 3:return[2]}}))}))};var INPUT_BLURRING=true;var startInputShims=function(n,r){return __awaiter(void 0,void 0,void 0,(function(){var e,t,i,o,a,u,c,d,l,f,s,v,S,_,w,p,I;return __generator(this,(function(m){switch(m.label){case 0:e=document;t=r==="ios";i=r==="android";o=n.getNumber("keyboardHeight",290);a=n.getBoolean("scrollAssist",true);u=n.getBoolean("hideCaretOnScroll",t);c=n.getBoolean("inputBlurring",t);d=n.getBoolean("scrollPadding",true);l=Array.from(e.querySelectorAll("ion-input, ion-textarea"));f=new WeakMap;s=new WeakMap;return[4,Keyboard.getResizeMode()];case 1:v=m.sent();S=function(n){return __awaiter(void 0,void 0,void 0,(function(){var r,e,t,c,l,S,l;return __generator(this,(function(_){switch(_.label){case 0:return[4,new Promise((function(r){return componentOnReady(n,r)}))];case 1:_.sent();r=n.shadowRoot||n;e=r.querySelector("input")||r.querySelector("textarea");t=findClosestIonContent(n);c=!t?n.closest("ion-footer"):null;if(!e){return[2]}if(!!t&&u&&!f.has(n)){l=enableHideCaretOnScroll(n,e,t);f.set(n,l)}S=e.type==="date"||e.type==="datetime-local";if(!S&&(!!t||!!c)&&a&&!s.has(n)){l=enableScrollAssist(n,e,t,c,o,d,v,i);s.set(n,l)}return[2]}}))}))};_=function(n){if(u){var r=f.get(n);if(r){r()}f.delete(n)}if(a){var r=s.get(n);if(r){r()}s.delete(n)}};if(c&&INPUT_BLURRING){enableInputBlurring()}for(w=0,p=l;w<p.length;w++){I=p[w];S(I)}e.addEventListener("ionInputDidLoad",(function(n){S(n.detail)}));e.addEventListener("ionInputDidUnload",(function(n){_(n.detail)}));return[2]}}))}))};export{startInputShims};